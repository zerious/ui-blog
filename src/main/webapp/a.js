(function(E){function p(){q("/Blog/api/",function(a){a=a.blog.posts;k(a,F);g.posts=a;u("index")})}function u(a){var b=r("body");a=G[a](g,g);z(b,a)}function F(a){var b=a.timestamp,b=v(b),d=b.getMonth(),c=b.getDate(),e=b.getFullYear();d++;var e=(""+e).substr(2),f;w.monthDay||(f=d,d=c,c=f);d=d+"/"+c+"/"+e;c=v(b);b=+c.getHours();e=+c.getMinutes();c=1;w.twelveHour?11<b?(c=0,12<b&&(b-=12)):b||(b=12):b=9<b?b:"0"+b;b=b+":"+(9<e?e:"0"+e);w.twelveHour&&(b+=c?"am":"pm");a.when=d+(" "+b);a.text=a.text.replace()}
var q=function(a,b,d){h(b)&&(d=b,b=0);var c=new XMLHttpRequest;c.onreadystatechange=function(a){if(4===c.readyState){a=c.status;var b=H(c.responseText,b);d(b,a)}};c.open(b?"POST":null===b?"DELETE":"GET",a,!0);b&&(c.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l(b)||(b=x(b)));c.send(b||null);return c},k=function(a,b){if(a){var d=a.length,c,e;if(A(d))for(c=0;c<d&&(e=b(a[c],c,a),0!==e);c++);else for(c in a)if(e=b(a[c],c,a),0===e)break;return c}},v=function(a){return a instanceof
Date?a:a?new Date(a):new Date},I=function(a){a=v(a);return a.toISOString()},J=function(a){var b=a;if(l(a)){var d=a.split("?"),c=d[0].split(".");a=c.slice(1).join(" ");var e=c[0].split("#"),c=e[0]||"div",e=e[1],d=d[1],f=/^(svg|g|path|circle|line)$/.test(c),b=document.createElementNS("http://www.w3.org/"+(f?"2000/svg":"1999/xhtml"),c);e&&(b.id=e);a&&(b.className=a);d&&(d=d.split("&"),k(d,function(a){var c=a.split("=");a=c[0];c=c[1];b[a]=c;B(b,a,c)}))}return b},C=function(a,b,d){l(a)&&(d=b,b=a,a=document.body);
b=J(b);A(d)&&(d=a.childNodes[d]);d?a.insertBefore(b,d):a.appendChild(b);return b},z=function(a,b){n(b)||(a.innerHTML=b);return a.innerHTML},B=function(a,b,d){if(null===d)a.removeAttribute(b);else if(n(d))d=a.getAttribute(b);else{var c=B(a,b);d!==c&&a.setAttribute(b,d)}return d},K=function(a,b,d){if(!b||h(b))d=b,b=a,a=document;a=a.querySelectorAll(b);d&&k(a,d);return a},r=function(a,b,d){if(!b||h(b))d=b,b=a,a=document;(a=a.querySelector(b))&&d&&d(a);return a},D=function(a,b){if(a){var d=a.type[0],
c=a.value,e=a.options,f=1<arguments.length,m,y,g;"c"===d||"r"===d?(m=K(a.form||document,"input[name="+a.name+"]"),y="c"===d&&1<m.length,g="checked"):e&&(m=e,y=a.multiple,g="selected");if(m){var h={},d=L(b);k(d,function(a){h[a]=1});c=[];k(m,function(a){var b=!!h[a.value];f?a[g]=b:a[g]&&c.push(a.value)});y||(c=c[0])}else f&&(a.value=b);return f?b:c}},w={months:"January February March April May June July August September October November December".split(" "),at:"at",monthDay:1,twelveHour:1,fahrenheit:1},
x=function(a,b){if(a instanceof Date||a&&h(a.toJSON)||l(a))a=JSON.stringify(a);else{if(h(a)||n(a))return b?"null":void 0;if(!a||"object"!==typeof a||a instanceof Boolean||a instanceof Number)a=t(a);else{b=b||[];var d;k(b,function(b){b===a&&(d=1)});if(d)return'"[Circular '+b.length+']"';b.push(a);var c=a instanceof Array,e=[];k(a,function(a,d){a=x(a,b);e.push(c?a:x(d)+":"+a)});b.pop();a=(c?"[":"{")+e.join(",")+(c?"]":"}")}}return a},H=function(a,b){try{eval("eval.J="+a),a=eval.J}catch(d){a=b}return a},
n=function(a){return"undefined"===typeof a},A=function(a){return"number"===typeof a||a instanceof Number},l=function(a){return"string"===typeof a||a instanceof String},h=function(a){return"function"===typeof a},t=function(a){return l(a)?a:""+a},L=function(a){return a instanceof Array?a:n(a)?[]:[a]},G={$:function(a){return(a||0===a?"object"===typeof a?JSON.stringify(a)||"":""+a:"").replace(/</g,"&lt;")},"&":void 0,edit:function(a,b){return""+this.page({block:function(){function b(a){return(a||0===
a?"object"===typeof a?JSON.stringify(a)||"":""+a:"").replace(/</g,"&lt;")}var c='<form id="edit">',c=a.post.id?c+"<h1>Edit Post</h1>":c+"<h2>New Post</h2>",c=c+('<div class="field"><label for="title">Title</label><input id="title" type="text" name="title" value="'+b(a.post.title)+'" style="width:100%"></div><div class="field"><label for="text">Text</label><textarea id="text" name="text" rows="20">'+b(a.post.text)+'</textarea></div><div class="field"><button onclick="blog.update('+a.post.id+');return false">'),
c=a.post.id?c+"Update Post":c+"Create Post";return c+"</button></div></form>"}},b||a)+""},index:function(a,b){return""+this.page({block:function(){function b(a){return(a||0===a?"object"===typeof a?JSON.stringify(a)||"":""+a:"").replace(/</g,"&lt;")}for(var c="",e,f=0,g=a.posts.length;f<g;++f)e=a.posts[f],c+='<a name="'+e.id+'"></a><div class="post"><h2>'+b(e.title)+' <i class="when">- '+b(e.when)+"</i></h2>"+e.text+'<p><button onclick="blog.edit('+e.id+')">Edit</button> <button onclick="blog.remove('+
e.id+')">Delete</button></p></div>';return c}},b||a)+""},page:function(a,b){var d=this.$,c;a.appName="My Blog";a.posts=(b||a).posts;c="<!DOCTYPE html><html><head><title>";c=a.title?c+(""+d(a.title)+" - "+d(a.appName)+""):c+(""+d(a.appName)+"");c+='</title></head><body><div id="top"><h1><a id="logo" onclick="blog.load()">'+d(a.appName)+'</a></h1></div><div id="side"><h3>Posts</h3>';for(var e,f=0,g=a.posts.length;f<g;++f)e=a.posts[f],c+='<a href="#'+e.id+'">'+d(e.when)+" - "+d(e.title)+"</a>";return c+=
'<p><button onclick="blog.edit()">New Post</button></p></div><div id="content">'+a.block.call(this,a)+"</div></body></html>"}},g={};p();(function(a){var b=r("head"),b=C(b,"style");n(a)||(z(b,""),C(b,document.createTextNode(a),void 0));if(b=b.styleSheet)b.cssText=a})("*{margin:0;border:0;padding:0;font-weight:400;box-sizing:border-box;line-height:1.5;-moz-box-sizing:border-box;tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out}html,body{width:100%;height:100%;overflow-x:hidden}body{-webkit-touch-callout:none;-webkit-text-size-adjust:none;-webkit-overflow-scrolling:touch;-ms-touch-action:none;-ms-content-zooming:none}body,td,th,var,button,input,select,textarea{font-size:16px;font-family:HelveticaNeue,Roboto,Helvetica,'Droid Sans',Arial;font-weight:400;line-height:1.5em;outline:none}a{color:#06c;text-decoration:none;cursor:pointer;outline:none}b{font-weight:600}h1{font-size:24px}h2{font-size:22px}h3{font-size:20px}p{margin:16px 0}::-webkit-input-placeholder{color:#bcd}:-moz-placeholder,::-moz-placeholder{color:#bcd}:-ms-input-placeholder{color:#bcd}#top{background:#0ae;padding:16px}#logo{color:#fff}#side{position:fixed;top:72px;bottom:0;padding:16px;border-right:1px solid #ddd;width:200px;overflow:scroll}#side>a{padding:4px 0}#content{margin-left:220px}#form,.post{padding:16px}.post{display:block;border-bottom:1px solid #eee}.when{color:#789;font-size:16px}.right{float:right}form{display:block;padding:16px}.field{margin:8px 0}button{background:#06c;color:#fff;border-radius:4px;padding:2px 12px}input,textarea,select{border:1px solid #789;padding:2px 4px;margin:2px 0}textarea{width:100%}*[type=hidden]{display:none}");
E.blog={load:p,edit:function(a){if(!a)return g.post={text:"",title:""},u("edit");q("/Blog/api/"+a,function(a){g.post=a.post;console.log(g.post);u("edit")})},update:function(a){a=a||"";var b=D(r("#title")),d=D(r("#text")),b="title="+encodeURIComponent(t(b))+"&text="+encodeURIComponent(t(d))+"&timestamp"+encodeURIComponent(t(I()));console.log(b);q("/Blog/api/"+a,b,function(a){p()})},remove:function(a){q("/Blog/api/"+a,null,function(a){p()})}}})(window)
